"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[1007],{12186:(G,E,n)=>{n.d(E,{A:()=>f});var e=n(21272),o=n(83314),I=n(34508),g=n(21270),k=n(57842),x=n(43242),l=n(90602),P=n(33544),t=n.n(P),D=n(54894),N=n(17703),L=n(44370),V=n(19106),A=n(39423);const U=({tokenName:s,onClickDelete:i,tokenType:c})=>{const{formatMessage:u}=(0,D.A)(),{trackUsage:p}=(0,l.z1)(),[r,d]=(0,e.useState)(!1),m=()=>{d(!1),p("willDeleteToken",{tokenType:c}),i()};return e.createElement(L.a,{paddingLeft:1,onClick:y=>y.stopPropagation()},e.createElement(V.K,{onClick:()=>{d(!0)},label:u({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${s}`}),name:"delete",noBorder:!0,icon:e.createElement(A.A,null)}),e.createElement(l.TM,{onToggleDialog:()=>d(!1),onConfirm:m,isOpen:r}))};U.propTypes={tokenName:t().string.isRequired,onClickDelete:t().func.isRequired,tokenType:t().string.isRequired};const K=U;var w=n(8046),Y=n(63891);const O={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},j=(0,Y.Ay)(l.N_)`
  svg {
    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:s})=>s.colors.neutral800};
      }
    }
  }
`,b=({tokenName:s,tokenId:i,buttonType:c,children:u})=>{const{formatMessage:p}=(0,D.A)(),{location:{pathname:r}}=(0,N.W6)();return e.createElement(j,{to:`${r}/${i}`,title:p(O[c],{target:s})},u)};b.propTypes={tokenName:t().string.isRequired,tokenId:t().oneOfType([t().string,t().number]).isRequired,buttonType:t().string,children:t().node.isRequired},b.defaultProps={buttonType:"edit"};const h=b,T=({tokenName:s,tokenId:i})=>e.createElement(h,{tokenName:s,tokenId:i,buttonType:"read"},e.createElement(w.A,null));T.propTypes={tokenName:t().string.isRequired,tokenId:t().oneOfType([t().string,t().number]).isRequired};const B=T;var W=n(31708);const v=({tokenName:s,tokenId:i})=>e.createElement(h,{tokenName:s,tokenId:i},e.createElement(W.A,null));v.propTypes={tokenName:t().string.isRequired,tokenId:t().oneOfType([t().string,t().number]).isRequired};const $=v,S=({permissions:s,headers:i,contentType:c,isLoading:u,tokens:p,onConfirmDelete:r,tokenType:d})=>{const{canDelete:m,canUpdate:y,canRead:C}=s;return e.createElement(l.Ee,{headers:i,contentType:c,rows:p,withBulkActions:m||y||C,isLoading:u,onConfirmDelete:r},e.createElement(R,{tokenType:d,permissions:s,onConfirmDelete:r}))};S.propTypes={tokens:t().array,permissions:t().shape({canRead:t().bool,canDelete:t().bool,canUpdate:t().bool}).isRequired,headers:t().arrayOf(t().shape({cellFormatter:t().func,key:t().string.isRequired,metadatas:t().shape({label:t().string.isRequired,sortable:t().bool}).isRequired,name:t().string.isRequired})),contentType:t().string.isRequired,isLoading:t().bool,onConfirmDelete:t().func,tokenType:t().string.isRequired},S.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const f=S,R=({tokenType:s,permissions:i,rows:c,withBulkActions:u,onConfirmDelete:p})=>{const{canDelete:r,canUpdate:d,canRead:m}=i,[{query:y}]=(0,l.sq)(),{formatMessage:C}=(0,D.A)(),[,z]=y?y.sort.split(":"):"ASC",{push:M,location:{pathname:F}}=(0,N.W6)(),{trackUsage:H}=(0,l.z1)(),Q=c.sort((a,X)=>{const J=a.name.localeCompare(X.name);return z==="DESC"?-J:J});return e.createElement(o.N,null,Q.map(a=>e.createElement(I.Tr,{key:a.id,...(0,l.qM)({fn(){H("willEditTokenFromList",{tokenType:s}),M(`${F}/${a.id}`)},condition:d})},e.createElement(g.Td,{maxWidth:(0,l.a8)(250)},e.createElement(k.o,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},a.name)),e.createElement(g.Td,{maxWidth:(0,l.a8)(250)},e.createElement(k.o,{textColor:"neutral800",ellipsis:!0},a.description)),e.createElement(g.Td,null,e.createElement(k.o,{textColor:"neutral800"},e.createElement(l.sR,{timestamp:new Date(a.createdAt)}))),e.createElement(g.Td,null,a.lastUsedAt&&e.createElement(k.o,{textColor:"neutral800"},e.createElement(l.sR,{timestamp:new Date(a.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:C({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]}))),u&&e.createElement(g.Td,null,e.createElement(x.s,{justifyContent:"end"},d&&e.createElement($,{tokenName:a.name,tokenId:a.id}),!d&&m&&e.createElement(B,{tokenName:a.name,tokenId:a.id}),r&&e.createElement(K,{tokenName:a.name,onClickDelete:()=>p(a.id),tokenType:s}))))))};R.defaultProps={rows:[],withBulkActions:!1},R.propTypes={rows:t().array,permissions:t().shape({canRead:t().bool,canDelete:t().bool,canUpdate:t().bool}).isRequired,onConfirmDelete:t().func.isRequired,tokenType:t().string.isRequired,withBulkActions:t().bool}},55286:(G,E,n)=>{n.d(E,{I:()=>e,j:()=>o});const e="api-token",o="transfer-token"},71358:(G,E,n)=>{n.r(E),n.d(E,{default:()=>b});var e=n(21272),o=n(90602),I=n(82437),g=n(71526),k=n(55794),x=n(43121),l=n(32559),P=n(31127),t=n(5409),D=n.n(t),N=n(54894),L=n(74930),V=n(17703),A=n(55286),U=n(12186);const w=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],O=()=>{(0,o.L4)();const h=(0,L.useQueryClient)(),{formatMessage:T}=(0,N.A)(),B=(0,o.hN)(),W=(0,I.d4)(g.G),{allowedActions:{canCreate:v,canDelete:$,canUpdate:S,canRead:f}}=(0,o.ec)(W.settings["api-tokens"]),{push:R}=(0,V.W6)(),{trackUsage:s}=(0,o.z1)(),{startSection:i}=(0,o.Cx)(),c=e.useRef(i),{get:u,del:p}=(0,o.ry)(),{formatAPIError:r}=(0,o.wq)();e.useEffect(()=>{c.current&&c.current("apiTokens")},[]),e.useEffect(()=>{R({search:D().stringify({sort:"name:ASC"},{encode:!1})})},[R]);const d=w.map(a=>({...a,metadatas:{...a.metadatas,label:T(a.metadatas.label)}})),{data:m,isLoading:y}=(0,L.useQuery)(["api-tokens"],async()=>{s("willAccessTokenList",{tokenType:A.I});const{data:{data:a}}=await u("/admin/api-tokens");return s("didAccessTokenList",{number:a.length,tokenType:A.I}),a},{cacheTime:0,enabled:f,onError(a){B({type:"warning",message:r(a)})}}),C=y,z=(0,L.useMutation)(async a=>{await p(`/admin/api-tokens/${a}`)},{async onSuccess(){await h.invalidateQueries(["api-tokens"]),s("didDeleteToken")},onError(a){B({type:"warning",message:r(a)})}}),M=m&&m.length>0,F=f&&M,H=f&&!M&&!v,Q=f&&!M&&v;return e.createElement(k.g,{"aria-busy":C},e.createElement(o.x7,{name:"API Tokens"}),e.createElement(x.Q,{title:T({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:T({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:v&&e.createElement(o.z9,{"data-testid":"create-api-token-button",startIcon:e.createElement(P.A,null),size:"S",onClick:()=>s("willAddTokenFromList",{tokenType:A.I}),to:"/settings/api-tokens/create"},T({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"}))}),e.createElement(l.s,null,!f&&e.createElement(o.UW,null),F&&e.createElement(U.A,{permissions:{canRead:f,canDelete:$,canUpdate:S},headers:d,contentType:"api-tokens",rows:m,isLoading:C,onConfirmDelete:a=>z.mutateAsync(a),tokens:m,tokenType:A.I}),Q&&e.createElement(o.R1,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:e.createElement(o.z9,{variant:"secondary",startIcon:e.createElement(P.A,null),to:"/settings/api-tokens/create"},T({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"}))}),H&&e.createElement(o.R1,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},b=()=>{const h=(0,I.d4)(g.G);return e.createElement(o.kz,{permissions:h.settings["api-tokens"].main},e.createElement(O,null))}}}]);
