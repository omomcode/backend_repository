"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[4563],{13252:(T,i,e)=>{e.d(i,{F:()=>l});var t=e(21272),r=e(90602),o=e(74930);function l(d={},a={}){const{id:s="",...p}=d,{get:u}=(0,r.ry)(),{data:n,isError:A,isLoading:P,refetch:D}=(0,o.useQuery)(["users",s,p],async()=>{const{data:{data:E}}=await u(`/admin/users/${s}`,{params:p});return E},a);return{users:t.useMemo(()=>{let E=[];return n&&("results"in n?Array.isArray(n.results)&&(E=n.results):E=[n]),E},[n]),pagination:t.useMemo(()=>(n&&"pagination"in n)??null,[n]),isLoading:P,isError:A,refetch:D}}},2976:(T,i,e)=>{e.d(i,{A:()=>n});var t=e(21272),r=e(44370),o=e(69564),l=e(90602),d=e(94013),a=e(33544),s=e.n(a),p=e(54894);const u=({displayedFilters:A})=>{const[P,D]=(0,t.useState)(!1),{formatMessage:f}=(0,p.A)(),E=(0,t.useRef)(),R=()=>{D(O=>!O)};return t.createElement(t.Fragment,null,t.createElement(r.a,{paddingTop:1,paddingBottom:1},t.createElement(o.$,{variant:"tertiary",ref:E,startIcon:t.createElement(d.A,null),onClick:R,size:"S"},f({id:"app.utils.filters",defaultMessage:"Filters"})),P&&t.createElement(l.LC,{displayedFilters:A,isVisible:P,onToggle:R,source:E})),t.createElement(l.cZ,{filtersSchema:A}))};u.propTypes={displayedFilters:s().arrayOf(s().shape({name:s().string.isRequired,metadatas:s().shape({label:s().string}),fieldSchema:s().shape({type:s().string})})).isRequired};const n=u},67626:(T,i,e)=>{e.d(i,{h:()=>pe,A:()=>be});var t=e(21272),r=e(55794),o=e(43121),l=e(44494),d=e(32559),a=e(90602),s=e(5409),p=e.n(s),u=e(54894),n=e(74930),A=e(82437),P=e(17703),D=e(13252),f=e(88022),E=e(71526),R=e(2976),O=e(69564),b=e(2570),se=e(33544),g=e.n(se);const q=({onClick:c})=>{const{formatMessage:h}=(0,u.A)();return t.createElement(O.$,{onClick:c,startIcon:t.createElement(b.A,null),size:"S"},h({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}))};q.propTypes={onClick:g().func.isRequired};var ne=e(83314),F=e(34508),X=e(21270),le=e(72182),j=e(57842),$=e(43242),ee=e(19106),M=e(44370),Me=e(31708),fe=e(39423),re=e(40609);const oe=({canDelete:c,headers:h,entriesToDelete:B,onClickDelete:k,onSelectRow:V,withMainAction:N,withBulkActions:x,rows:I})=>{const{push:C,location:{pathname:Q}}=(0,P.W6)(),{formatMessage:L}=(0,u.A)();return t.createElement(ne.N,null,I.map(m=>{const z=B.findIndex(S=>S===m.id)!==-1;return t.createElement(F.Tr,{key:m.id,...(0,a.qM)({fn:()=>C(`${Q}/${m.id}`),condition:x})},N&&t.createElement(X.Td,{...a.dG},t.createElement(le.J,{"aria-label":L({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,re.d)(m.firstname,m.lastname)}),checked:z,onChange:()=>{V({name:m.id,value:!z})}})),h.map(({key:S,cellFormatter:Y,name:K,...H})=>t.createElement(X.Td,{key:S},typeof Y=="function"?Y(m,{key:S,name:K,formatMessage:L,...H}):t.createElement(j.o,{textColor:"neutral800"},m[K]||"-"))),x&&t.createElement(X.Td,null,t.createElement($.s,{justifyContent:"end"},t.createElement(ee.K,{onClick:()=>C(`${Q}/${m.id}`),label:L({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,re.d)(m.firstname,m.lastname)}),noBorder:!0,icon:t.createElement(Me.A,null)}),c&&t.createElement(M.a,{paddingLeft:1,...a.dG},t.createElement(ee.K,{onClick:()=>k(m.id),label:L({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,re.d)(m.firstname,m.lastname)}),noBorder:!0,icon:t.createElement(fe.A,null)})))))}))};oe.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},oe.propTypes={canDelete:g().bool,entriesToDelete:g().array,headers:g().array.isRequired,onClickDelete:g().func,onSelectRow:g().func,rows:g().array,withBulkActions:g().bool,withMainAction:g().bool};const he=oe;var ve=e(50642),ye=e(6479),Ae=e(53900),me=e(57564),ie=e(68065),Pe=e(32161),De=e(37679),Ce=e(60043),Oe=e(61535),Le=e(94844),Te=e(85842),J=e(12083);const ue={firstname:"",lastname:"",email:"",roles:[]},Re=[],Be=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],Ue=J.Ik().shape({firstname:J.Yj().trim().required(a.iW.required),lastname:J.Yj(),email:J.Yj().email(a.iW.email).required(a.iW.required),roles:J.YO().min(1,a.iW.required).required(a.iW.required)}),Ie={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},Ee=({onSuccess:c,onToggle:h})=>{const[B,k]=(0,t.useState)("create"),[V,N]=(0,t.useState)(!1),[x,I]=(0,t.useState)(null),{formatMessage:C}=(0,u.A)(),Q=(0,a.hN)(),{lockApp:L,unlockApp:m}=(0,a.MA)(),{post:z}=(0,a.ry)(),S=(0,f.h)(Re,async()=>(await e.e(9452).then(e.bind(e,99452))).ROLE_LAYOUT,{combine(y,W){return[...y,W]},defaultValue:[]}),Y=(0,f.h)(ue,async()=>(await e.e(9452).then(e.bind(e,99452))).FORM_INITIAL_VALUES,{combine(y,W){return{...y,...W}},defaultValue:ue}),K=(0,f.h)(Le.g,async()=>(await e.e(9034).then(e.bind(e,69034))).MagicLinkEE),H=(0,n.useMutation)(y=>z("/admin/users",y),{async onSuccess({data:y}){I(y.data.registrationToken),await c(),ae(),N(!1)},onError(y){throw N(!1),Q({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),y},onSettled(){m()}}),w=C({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),te=async(y,{setErrors:W})=>{L(),N(!0);try{await H.mutateAsync(y)}catch(Z){m(),Z?.response?.data?.error.message==="Email already taken"&&W({email:Z.response.data.error.message})}},ae=()=>{v?k(v):h()},{buttonSubmitLabel:_,isDisabled:G,next:v}=Ie[B],Fe=B==="create"?t.createElement(O.$,{type:"submit",loading:V},C(_)):t.createElement(O.$,{type:"button",loading:V,onClick:h},C(_));return K?t.createElement(ve.k,{onClose:h,labelledBy:"title"},t.createElement(ye.r,null,t.createElement(De.B,{label:w},t.createElement(Ce.m,{isCurrent:!0},w))),t.createElement(Oe.l1,{enableReinitialize:!0,initialValues:Y,onSubmit:te,validationSchema:Ue,validateOnChange:!1},({errors:y,handleChange:W,values:Z})=>t.createElement(a.lV,null,t.createElement(Ae.c,null,t.createElement($.s,{direction:"column",alignItems:"stretch",gap:6},B!=="create"&&t.createElement(K,{registrationToken:x}),t.createElement(M.a,null,t.createElement(j.o,{variant:"beta",as:"h2"},C({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})),t.createElement(M.a,{paddingTop:4},t.createElement($.s,{direction:"column",alignItems:"stretch",gap:1},t.createElement(me.x,{gap:5},Be.map(ce=>ce.map(U=>t.createElement(ie.E,{key:U.name,...U.size},t.createElement(a.ah,{...U,disabled:G,error:y[U.name],onChange:W,value:Z[U.name]})))))))),t.createElement(M.a,null,t.createElement(j.o,{variant:"beta",as:"h2"},C({id:"global.roles",defaultMessage:"User's role"})),t.createElement(M.a,{paddingTop:4},t.createElement(me.x,{gap:5},t.createElement(ie.E,{col:6,xs:12},t.createElement(Te.A,{disabled:G,error:y.roles,onChange:W,value:Z.roles})),S.map(ce=>ce.map(U=>t.createElement(ie.E,{key:U.name,...U.size},t.createElement(a.ah,{...U,disabled:G,onChange:W,value:Z[U.name]}))))))))),t.createElement(Pe.j,{startActions:t.createElement(O.$,{variant:"tertiary",onClick:h,type:"button"},C({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:Fe})))):null};Ee.propTypes={onToggle:g().func.isRequired,onSuccess:g().func.isRequired};const Se=Ee,de=({pagination:c})=>t.createElement(M.a,{paddingTop:4},t.createElement($.s,{alignItems:"flex-end",justifyContent:"space-between"},t.createElement(a._u,null),t.createElement(a.W7,{pagination:c})));de.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},de.propTypes={pagination:g().shape({page:g().number,pageCount:g().number,pageSize:g().number,total:g().number})};const We=de,xe=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],Ke=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:c},{formatMessage:h}){return t.createElement(j.o,{textColor:"neutral800"},c.map(B=>h({id:`Settings.permissions.users.${B.code}`,defaultMessage:B.name})).join(`,
`))}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:c},{formatMessage:h}){return t.createElement($.s,null,t.createElement(a.nW,{isActive:c,variant:c?"success":"danger"}),t.createElement(j.o,{textColor:"neutral800"},h({id:c?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:c?"Active":"Inactive"})))}}],ge=["ee","license-limit-info"],pe=()=>{const{post:c}=(0,a.ry)(),{formatAPIError:h}=(0,a.wq)(),[B,k]=(0,t.useState)(!1),V=(0,A.d4)(E.G),{allowedActions:{canCreate:N,canDelete:x,canRead:I}}=(0,a.ec)(V.settings.users),C=(0,n.useQueryClient)(),Q=(0,a.hN)(),{formatMessage:L}=(0,u.A)(),{search:m}=(0,P.zy)();(0,a.L4)();const{users:z,pagination:S,isError:Y,isLoading:K,refetch:H}=(0,D.F)(p().parse(m,{ignoreQueryPrefix:!0}),{cacheTime:0,enabled:I}),w=(0,f.h)(q,async()=>(await e.e(224).then(e.bind(e,80224))).CreateActionEE),te=Ke.map(v=>({...v,metadatas:{...v.metadatas,label:L(v.metadatas.label)}})),ae=L({id:"global.users",defaultMessage:"Users"}),_=()=>{k(v=>!v)},G=(0,n.useMutation)(async v=>{await c("/admin/users/batch-delete",{ids:v})},{async onSuccess(){await H(),await C.refetchQueries(ge)},onError(v){Q({type:"warning",message:{id:"notification.error",message:h(v),defaultMessage:"An error occured"}})}});return w?t.createElement(r.g,{"aria-busy":K},t.createElement(a.x7,{name:"Users"}),t.createElement(o.Q,{primaryAction:N&&t.createElement(w,{onClick:_}),title:ae,subtitle:L({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),I&&t.createElement(l.B,{startActions:t.createElement(t.Fragment,null,t.createElement(a.q7,{label:L({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:ae})}),t.createElement(R.A,{displayedFilters:xe}))}),t.createElement(d.s,{canRead:I},!I&&t.createElement(a.UW,null),Y&&t.createElement("div",null,"TODO: An error occurred"),I&&t.createElement(t.Fragment,null,t.createElement(a.Ee,{contentType:"Users",isLoading:K,onConfirmDeleteAll:G.mutateAsync,onConfirmDelete:v=>G.mutateAsync([v]),headers:te,rows:z,withBulkActions:!0,withMainAction:x},t.createElement(he,{canDelete:x,headers:te,rows:z,withBulkActions:!0,withMainAction:x})),S&&t.createElement(We,{pagination:S}))),B&&t.createElement(Se,{onSuccess:async()=>{await H(),await C.refetchQueries(ge)},onToggle:_})):null},be=()=>{const c=(0,f.h)(pe,async()=>(await e.e(6869).then(e.bind(e,86869))).UserListPageEE);return c?t.createElement(c,null):null}},50125:(T,i,e)=>{e.r(i),e.d(i,{default:()=>s});var t=e(21272),r=e(90602),o=e(82437),l=e(71526),d=e(67626);const s=()=>{const p=(0,o.d4)(l.G);return t.createElement(r.kz,{permissions:p.settings.users.main},t.createElement(d.A,null))}},16888:(T,i,e)=>{e.d(i,{A:()=>u});var t=e(21272),r=e(19106),o=e(90602),l=e(72702),d=e(33544),a=e.n(d),s=e(54894);const p=({children:n,target:A})=>{const P=(0,o.hN)(),{formatMessage:D}=(0,s.A)(),{copy:f}=(0,o.iD)(),E=D({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),R=async()=>{await f(A)&&P({type:"info",message:{id:"notification.link-copied"}})};return t.createElement(o.bQ,{endAction:t.createElement(r.K,{label:E,noBorder:!0,icon:t.createElement(l.A,null),onClick:R}),title:A,titleEllipsis:!0,subtitle:n,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};p.propTypes={children:a().oneOfType([a().element,a().string]).isRequired,target:a().string.isRequired};const u=p},94844:(T,i,e)=>{e.d(i,{g:()=>s});var t=e(21272),r=e(33544),o=e.n(r),l=e(54894),d=e(13275),a=e(16888);const s=({registrationToken:p})=>{const{formatMessage:u}=(0,l.A)(),n=`${window.location.origin}${d.A}auth/register?registrationToken=${p}`;return t.createElement(a.A,{target:n},u({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};s.defaultProps={registrationToken:""},s.propTypes={registrationToken:o().string}},85842:(T,i,e)=>{e.d(i,{A:()=>R});var t=e(21272),r=e(45024),o=e(89787),l=e(90602),d=e(16034),a=e(33544),s=e.n(a),p=e(54894),u=e(74930),n=e(63891);const A=(0,n.i7)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,P=n.Ay.div`
  animation: ${A} 2s infinite linear;
`,D=()=>t.createElement(P,null,t.createElement(d.A,null)),f=async()=>{const{get:O}=(0,l.GD)(),{data:b}=await O("/admin/roles");return b.data},E=({disabled:O,error:b,onChange:se,value:g})=>{const{status:q,data:ne}=(0,u.useQuery)(["roles"],f,{staleTime:5e4}),{formatMessage:F}=(0,p.A)(),X=b?F({id:b,defaultMessage:b}):"",le=F({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),j=F({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),$=F({id:"app.components.Select.placeholder",defaultMessage:"Select"}),ee=q==="loading"?t.createElement(D,null):void 0;return t.createElement(r.l,{id:"roles",disabled:O,error:X,hint:j,label:le,name:"roles",onChange:M=>{se({target:{name:"roles",value:M}})},placeholder:$,multi:!0,startIcon:ee,value:g.map(M=>M.toString()),withTags:!0,required:!0},(ne||[]).map(M=>t.createElement(o.c,{key:M.id,value:M.id.toString()},F({id:`global.${M.code}`,defaultMessage:M.name}))))};E.defaultProps={disabled:!1,error:void 0},E.propTypes={disabled:s().bool,error:s().string,onChange:s().func.isRequired,value:s().array.isRequired};const R=E},44494:(T,i,e)=>{e.d(i,{B:()=>o});var t=e(92132),r=e(43242);const o=({startActions:l,endActions:d})=>!l&&!d?null:(0,t.jsxs)(r.s,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,t.jsx)(r.s,{gap:2,wrap:"wrap",children:l}),(0,t.jsx)(r.s,{gap:2,shrink:0,wrap:"wrap",children:d})]})},2570:(T,i,e)=>{e.d(i,{A:()=>o});var t=e(92132);const r=l=>(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...l,children:[(0,t.jsx)("path",{fill:"#32324D",d:"M0 2.8A.8.8 0 0 1 .8 2h22.4a.8.8 0 0 1 .8.8v2.71a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V2.8Z"}),(0,t.jsx)("path",{fill:"#32324D",d:"M1.922 7.991C.197 6.675 0 6.252 0 5.289h23.953c.305 1.363-1.594 2.506-2.297 3.125-1.953 1.363-6.253 4.36-7.828 5.45-1.575 1.09-3.031.455-3.562 0-2.063-1.41-6.62-4.557-8.344-5.873ZM22.8 18H1.2c-.663 0-1.2.471-1.2 1.053v1.894C0 21.529.537 22 1.2 22h21.6c.663 0 1.2-.471 1.2-1.053v-1.894c0-.582-.537-1.053-1.2-1.053Z"}),(0,t.jsx)("path",{fill:"#32324D",d:"M0 9.555v10.972h24V9.554c-2.633 1.95-8.367 6.113-9.96 7.166-1.595 1.052-3.352.438-4.032 0L0 9.555Z"})]}),o=r},37679:(T,i,e)=>{e.d(i,{B:()=>u});var t=e(92132),r=e(21272),o=e(63891),l=e(94061),d=e(30893);const a=()=>(0,t.jsx)(l.a,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,t.jsx)(d.o,{variant:"pi",textColor:"neutral500",children:"/"})});a.displayName="Divider";var s=e(83997);const p=(0,o.Ay)(s.s)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:n})=>`calc(-1*${n.spaces[2]})`};
  }
`,u=({label:n,children:A,...P})=>{const D=r.Children.toArray(A);return(0,t.jsx)(l.a,{"aria-label":n,...P,children:(0,t.jsx)(p,{as:"ol",children:r.Children.map(D,(f,E)=>{const R=D.length>1&&E+1<D.length;return(0,t.jsxs)(s.s,{inline:!0,as:"li",children:[f,R&&(0,t.jsx)(a,{})]})})})})};u.displayName="Breadcrumbs"},60043:(T,i,e)=>{e.d(i,{m:()=>l});var t=e(92132),r=e(94061),o=e(30893);const l=({children:d,isCurrent:a=!1,...s})=>(0,t.jsx)(r.a,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,t.jsx)(o.o,{variant:"pi",textColor:"neutral800",fontWeight:a?"bold":"normal","aria-current":a,...s,children:d})});l.displayName="Crumb"}}]);
