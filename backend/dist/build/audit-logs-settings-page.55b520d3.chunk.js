"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[5606],{13252:(R,E,t)=>{t.d(E,{F:()=>p});var e=t(96540),s=t(78263),y=t(75942);function p(L={},h={}){const{id:d="",...T}=L,{get:A}=(0,s.ry)(),{data:c,isError:v,isLoading:P,refetch:D}=(0,y.useQuery)(["users",d,T],async()=>{const{data:{data:M}}=await A(`/admin/users/${d}`,{params:T});return M},h);return{users:e.useMemo(()=>{let M=[];return c&&("results"in c?Array.isArray(c.results)&&(M=c.results):M=[c]),M},[c]),pagination:e.useMemo(()=>(c&&"pagination"in c)??null,[c]),isLoading:P,isError:v,refetch:D}}},2976:(R,E,t)=>{t.d(E,{A:()=>c});var e=t(96540),s=t(28992),y=t(78738),p=t(78263),L=t(46687),h=t(5556),d=t.n(h),T=t(6442);const A=({displayedFilters:v})=>{const[P,D]=(0,e.useState)(!1),{formatMessage:b}=(0,T.A)(),M=(0,e.useRef)(),B=()=>{D(W=>!W)};return e.createElement(e.Fragment,null,e.createElement(s.a,{paddingTop:1,paddingBottom:1},e.createElement(y.$,{variant:"tertiary",ref:M,startIcon:e.createElement(L.A,null),onClick:B,size:"S"},b({id:"app.utils.filters",defaultMessage:"Filters"})),P&&e.createElement(p.LC,{displayedFilters:v,isVisible:P,onToggle:B,source:M})),e.createElement(p.cZ,{filtersSchema:v}))};A.propTypes={displayedFilters:d().arrayOf(d().shape({name:d().string.isRequired,metadatas:d().shape({label:d().string}),fieldSchema:d().shape({type:d().string})})).isRequired};const c=A},34867:(R,E,t)=>{t.r(E),t.d(E,{default:()=>he});var e=t(96540),s=t(78263),y=t(13561),p=t(71526),L=t(5774),h=t(17433),d=t(28992),T=t(87304),A=t(72660),c=t(76592),v=t(6442),P=t(2976),D=t(75942),b=t(56347),M=t(13252);const W=({canReadAuditLogs:a,canReadUsers:m})=>{const{get:g}=(0,s.ry)(),{search:i}=(0,b.zy)(),u=(0,s.hN)(),[{query:l}]=(0,s.sq)(),n={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:C=>u({type:"warning",message:C.message})},{users:r,isError:f,isLoading:O}=(0,M.F)({},{...n,enabled:m,staleTime:2*(1e3*60)}),{data:S,isLoading:F,isError:j}=(0,D.useQuery)(["auditLogs",i],async()=>{const{data:C}=await g("/admin/audit-logs",{params:l});return C},{...n,enabled:a});return{auditLogs:S,users:r,isLoading:O||F,hasError:j||f}};var w=t(63168),k=t(86621),q=t(96230),_=t(93117),ee=t(84877),te=t(5556),o=t.n(te),ae=t(1806);const H=()=>{const{formatDate:a}=(0,v.A)();return g=>{const i=(0,ae.A)(g),u=a(i,{dateStyle:"long"}),l=a(i,{timeStyle:"medium",hourCycle:"h24"});return`${u}, ${l}`}};var U=t(61160),se=t(76915),x=t(63188),ne=t(94482),oe=t(32315);const G={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},K=a=>G[a]||a,Q=({actionLabel:a,actionName:m})=>e.createElement(U.s,{direction:"column",alignItems:"baseline",gap:1},e.createElement(x.o,{textColor:"neutral600",variant:"sigma"},a),e.createElement(x.o,{textColor:"neutral600"},m));Q.propTypes={actionLabel:o().string.isRequired,actionName:o().string.isRequired};const I=Q,N=({status:a,data:m,formattedDate:g})=>{const{formatMessage:i}=(0,v.A)();if(a==="loading")return e.createElement(U.s,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(se.a,null,"Loading content..."));const{action:u,user:l,payload:n}=m;return e.createElement(e.Fragment,null,e.createElement(d.a,{marginBottom:3},e.createElement(x.o,{variant:"delta",id:"title"},i({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(ne.x,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(I,{actionLabel:i({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:i({id:`Settings.permissions.auditLogs.${u}`,defaultMessage:K(u)},{model:n?.model})}),e.createElement(I,{actionLabel:i({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:g}),e.createElement(I,{actionLabel:i({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:l?.displayName||"-"}),e.createElement(I,{actionLabel:i({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:l?.id.toString()||"-"})),e.createElement(oe.j,{value:JSON.stringify(n,null,2),disabled:!0,label:i({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};N.defaultProps={data:{}},N.propTypes={status:o().oneOf(["idle","loading","error","success"]).isRequired,data:o().shape({action:o().string,date:o().string,payload:o().object,user:o().object}),formattedDate:o().string.isRequired};const ie=N,J=({handleClose:a,logId:m})=>{const{get:g}=(0,s.ry)(),i=(0,s.hN)(),u=async O=>{const{data:S}=await g(`/admin/audit-logs/${O}`);if(!S)throw new Error("Audit log not found");return S},{data:l,status:n}=(0,D.useQuery)(["audit-log",m],()=>u(m),{onError(){i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),a()}}),r=H(),f=l?r(l.date):"";return e.createElement(w.k,{onClose:a,labelledBy:"title"},e.createElement(k.r,null,e.createElement(_.B,{label:f,id:"title"},e.createElement(ee.m,{isCurrent:!0},f))),e.createElement(q.c,null,e.createElement(ie,{status:n,data:l,formattedDate:f})))};J.propTypes={handleClose:o().func.isRequired,logId:o().string.isRequired};const re=J,$=({pagination:a})=>e.createElement(d.a,{paddingTop:4},e.createElement(U.s,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(s._u,null),e.createElement(s.W7,{pagination:a})));$.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},$.propTypes={pagination:o().shape({page:o().number,pageCount:o().number,pageSize:o().number,total:o().number})};const le=$;var de=t(21292),me=t(12846),Y=t(25392),ue=t(98528),ce=t(97948);const V=({headers:a,rows:m,onOpenModal:g})=>{const{formatMessage:i}=(0,v.A)(),u=H(),l=({type:n,value:r,model:f})=>n==="date"?u(r):n==="action"?i({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:K(r)},{model:f}):r||"-";return e.createElement(de.N,null,m.map(n=>e.createElement(me.Tr,{key:n.id,...(0,s.qM)({fn:()=>g(n.id)})},a.map(({key:r,name:f,cellFormatter:O})=>e.createElement(Y.Td,{key:r},e.createElement(x.o,{textColor:"neutral800"},l({type:r,value:O?O(n[f]):n[f],model:n.payload?.model})))),e.createElement(Y.Td,{...s.dG},e.createElement(U.s,{justifyContent:"end"},e.createElement(ue.K,{onClick:()=>g(n.id),"aria-label":i({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${n.action} action`}),noBorder:!0,icon:e.createElement(ce.A,null)}))))))};V.defaultProps={rows:[]},V.propTypes={headers:o().array.isRequired,rows:o().array,onOpenModal:o().func.isRequired};const ge=V;var pe=t(52492),Ee=t(9439);const z=({value:a,options:m,onChange:g})=>{const{formatMessage:i}=(0,v.A)(),u=i({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(pe.G3,{"aria-label":u,value:a,onChange:g},m.map(({label:l,customValue:n})=>e.createElement(Ee.j,{key:n,value:n},l)))};z.defaultProps={value:null},z.propTypes={value:o().string,options:o().arrayOf(o().shape({label:o().string.isRequired,customValue:o().string.isRequired}).isRequired).isRequired,onChange:o().func.isRequired};const X=z,Z=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],fe=({formatMessage:a,users:m,canReadUsers:g})=>{const i=Object.keys(G).map(l=>({label:a({id:`Settings.permissions.auditLogs.${l}`,defaultMessage:K(l)},{model:void 0}),customValue:l})),u=[{name:"action",metadatas:{customOperators:Z,label:a({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),customInput:X,options:i},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:a({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(g&&m){const l=r=>r.username?r.username:r.firstname&&r.lastname?a({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:r.firstname,lastname:r.lastname}):r.email,n=m.map(r=>({label:l(r),customValue:r.id.toString()}));return[...u,{name:"user",metadatas:{customOperators:Z,label:a({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:n,customInput:X},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return u},ye=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:a=>a?a.displayName:""}],Le=()=>{const{formatMessage:a}=(0,v.A)(),m=(0,y.d4)(p.G),{allowedActions:{canRead:g,canReadUsers:i}}=(0,s.ec)({...m.settings.auditLogs,readUsers:m.settings.users.read}),[{query:u},l]=(0,s.sq)(),{auditLogs:n,users:r,isLoading:f,hasError:O}=W({canReadAuditLogs:g,canReadUsers:i});(0,s.L4)();const S=fe({formatMessage:a,users:r,canReadUsers:i}),F=a({id:"global.auditLogs",defaultMessage:"Audit Logs"}),j=ye.map(C=>({...C,metadatas:{...C.metadatas,label:a(C.metadatas.label)}}));return O?e.createElement(L.P,null,e.createElement(h.s,null,e.createElement(d.a,{paddingTop:8},e.createElement(s.hH,null)))):e.createElement(T.g,{"aria-busy":f},e.createElement(s.x7,{name:F}),e.createElement(A.Q,{title:F,subtitle:a({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(c.B,{startActions:e.createElement(P.A,{displayedFilters:S})}),e.createElement(h.s,{canRead:g},e.createElement(s.Ee,{contentType:"Audit logs",headers:j,rows:n?.results||[],withBulkActions:!0,isLoading:f},e.createElement(ge,{headers:j,rows:n?.results||[],onOpenModal:C=>l({id:C})})),e.createElement(le,{pagination:n?.pagination})),u?.id&&e.createElement(re,{handleClose:()=>l({id:null},"remove"),logId:u.id}))},he=()=>{const a=(0,y.d4)(p.G);return e.createElement(s.kz,{permissions:a.settings.auditLogs.main},e.createElement(Le,null))}},9439:(R,E,t)=>{t.d(E,{j:()=>s});var e=t(52492);const s=e.c$},76592:(R,E,t)=>{t.d(E,{B:()=>y});var e=t(74848),s=t(61160);const y=({startActions:p,endActions:L})=>!p&&!L?null:(0,e.jsxs)(s.s,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(s.s,{gap:2,wrap:"wrap",children:p}),(0,e.jsx)(s.s,{gap:2,shrink:0,wrap:"wrap",children:L})]})},93117:(R,E,t)=>{t.d(E,{B:()=>A});var e=t(74848),s=t(96540),y=t(67336),p=t(17715),L=t(17937);const h=()=>(0,e.jsx)(p.a,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,e.jsx)(L.o,{variant:"pi",textColor:"neutral500",children:"/"})});h.displayName="Divider";var d=t(6803);const T=(0,y.Ay)(d.s)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:c})=>`calc(-1*${c.spaces[2]})`};
  }
`,A=({label:c,children:v,...P})=>{const D=s.Children.toArray(v);return(0,e.jsx)(p.a,{"aria-label":c,...P,children:(0,e.jsx)(T,{as:"ol",children:s.Children.map(D,(b,M)=>{const B=D.length>1&&M+1<D.length;return(0,e.jsxs)(d.s,{inline:!0,as:"li",children:[b,B&&(0,e.jsx)(h,{})]})})})})};A.displayName="Breadcrumbs"},84877:(R,E,t)=>{t.d(E,{m:()=>p});var e=t(74848),s=t(17715),y=t(17937);const p=({children:L,isCurrent:h=!1,...d})=>(0,e.jsx)(s.a,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,e.jsx)(y.o,{variant:"pi",textColor:"neutral800",fontWeight:h?"bold":"normal","aria-current":h,...d,children:L})});p.displayName="Crumb"}}]);
